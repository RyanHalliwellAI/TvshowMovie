<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Read CSV File</title>
    <h1>Read CSV File</h1>
    <div class="container mt-5">
        <h1 class="text-center mb-4">TV Show Tracker</h1><br>
        <div class="form-group">
            <br><label for="tvShowMovie">Enter Movie or TV Show:</label>
            <input type="text" class="form-control" id="tvShowMovie" name="tvShowMovie" placeholder="Type here...">
            <br><label for="typeOfShow">Enter Genre:</label>
            <input type="text" class="form-control" id="typeOfShow" name="typeOfShow" placeholder="Type here...">
        </div>
        <button onclick="search()" type="submit" class="btn btn-primary mt-3">Search</button>
        <div class="TV"></div>
    </div>

    <script>
        let dictionary = {};

        function processData(data) {
            const rows = data.split('\n'); 
            rows.forEach((row,mainIndex) => {
                const cells = row.split(','); 
                dictionary[cells[0]] = cells.slice(1,8);
            });
        }
        // Function to find the key with a value at index 0 equal to "Game"
        function findKeyValuePairsWithGame(dict, search, searchTermGenre ) {
            let result = {};
            console.log(searchTerm);
            for (let key in dict) {
                if (Array.isArray(dict[key]) && dict[key][0] && dict[key][0].toLowerCase().includes(search)) {
                    result[key] = dict[key];
                }
            }
            return result; 
        }       
        function search() {
            const searchTerm = document.getElementById('tvShowMovie').value.trim().toLowerCase();
            const searchTermGenre = document.getElementById('typeOfShow').value.trim().toLowerCase();

            const result = findKeyValuePairsWithGame(dictionary, searchTerm, searchTermGenre);
            displayResult(result);
        }
        //loops through all the key value pairrts in the dictionary and adds it to a cell in the current row and displays it.
        //if no results will display no reuslts found
        function displayResult(result) {
            const tvDiv = document.querySelector('.TV');
            tvDiv.innerHTML = Object.keys(result).length ? //checks if there is any keys
                `<table>
                    <thead>
                        <tr>
                            <th>tconst</th><th>title</th><th>startYear</th><th>endYear</th><th>runtime</th><th>genres</th><th>avgRating</th><th>numVotes</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${Object.keys(result).map(key =>  //loops over each key then creates new cell for each value
                            `<tr>
                                <td>${key}</td> 
                                ${result[key].map(value => `<td>${value}</td>`).join('')}  
                            </tr>`).join('')}
                    </tbody>
                </table>` : '<p>No results found.</p>';
        }

        
    </script>
</head>
<body>
    <script>
        const filePath = './tvshows.csv'; 
        fetch(filePath)
            .then(response => response.text())
            .then(data => processData(data))
            .catch(error => console.error('Error fetching the file:', error));
    </script>
</body>
</html>